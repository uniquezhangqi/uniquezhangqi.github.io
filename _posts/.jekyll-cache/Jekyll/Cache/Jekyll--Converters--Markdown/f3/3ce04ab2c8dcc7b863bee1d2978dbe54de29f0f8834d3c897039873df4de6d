I"ÿ¤<h2 id="spring-data-jpa">Spring Data JPA</h2>
<p>ã€€ã€€è‡ªä»ç”¨äº†Spring Data JPAä¹‹åä¸ªäººæ„Ÿè§‰æ¯”hibernateã€mybatiså¥½ç”¨å¤ªå¤šäº†â€”SpringData JAPéå¸¸å¥‘åˆOOPæ€æƒ³ã€‚å¦‚ï¼šè®¾è®¡æ¨¡å¼çš„<a href="http://uniquezhangqi.top/2018/02/04/è‡ªæˆ‘æ€»ç»“-è®¾è®¡æ¨¡å¼æ€»ç»“(ä¸€)/">å¼€æ”¾-å°é—­åŸåˆ™ã€ä¾èµ–å€’è½¬åŸåˆ™ã€å•ä¸€èŒè´£</a>ã€<a href="http://uniquezhangqi.top/2018/03/02/è‡ªæˆ‘æ€»ç»“-è®¾è®¡æ¨¡å¼æ€»ç»“(äºŒ)/">è¿ªç±³ç‰¹æ³•åˆ™</a>ç­‰ç­‰ï¼Œä¹Ÿæ˜¯OOPéå¸¸éå¸¸æ ¸å¿ƒçš„ä¸œè¥¿ï¼ˆæŒ‰ä½Ctrl+é¼ æ ‡å·¦é”®ç‚¹å‡»è“è‰²çš„å¯ä»¥æŸ¥çœ‹å¯¹åº”æ¨¡å¼)â€¦æˆ‘çš„GitHubä¸Šæœ€è¿‘åœ¨æ›´æ–°ä¸€ä¸ª<a href="https://github.com/uniquezhangqi/SpringDemo">Springã€SpringDataJPAã€shiro</a>æ¡†æ¶æ•´åˆçš„ä¸€ä¸ªå°é¡¹ç›®,æœ‰å…´è¶£å¯ä»¥ç…ç…ï¼›ä¸‹é¢æ˜¯æˆ‘è½¬è½½çš„ä¸€ç¯‡SpringDataJPAå…¥é—¨çš„æ–‡ç« ï¼ŒGitHubä¸Šè¿˜æœ‰ä¸€ä¸ª<a href="https://github.com/spring-projects/spring-data-examples/tree/master/jpa/showcase">Demo</a>ã€‚
ã€€ã€€</p>
<h4 id="the-domain">The domain</h4>

<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªå¾ˆå°çš„ç€ååŸŸå¼€å§‹ï¼šæˆ‘ä»¬<code class="language-plaintext highlighter-rouge">Customer</code>å’Œ<code class="language-plaintext highlighter-rouge">Accounts</code>ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nc">String</span> <span class="n">firstname</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastname</span><span class="o">;</span>

  <span class="c1">// â€¦ methods omitted</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="kd">private</span> <span class="nc">Customer</span> <span class="n">customer</span><span class="o">;</span>

  <span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Date</span> <span class="n">expiryDate</span><span class="o">;</span>

  <span class="c1">// â€¦ methods omitted</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¯¥<code class="language-plaintext highlighter-rouge">Account</code>æœ‰æˆ‘ä»¬å°†åœ¨ç¨åé˜¶æ®µä½¿ç”¨çš„æœ‰æ•ˆæœŸé™ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºç±»æˆ–æ˜ å°„æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ - å®ƒä½¿ç”¨æ™®é€šçš„JPAæ³¨é‡Šã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ç»„ä»¶ç®¡ç†<code class="language-plaintext highlighter-rouge">Account</code>å¯¹è±¡</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="nc">AccountService</span> <span class="o">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TypedQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Account a where a.customer = ?1"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">customer</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æˆ‘æ•…æ„å‘½åè¯¥ç±»<code class="language-plaintext highlighter-rouge">*Service</code>ä»¥é¿å…åç§°å†²çªï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨å¼€å§‹é‡æ„æ—¶å¼•å…¥ä¸€ä¸ªå­˜å‚¨åº“å±‚ã€‚ä½†ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™é‡Œçš„è¯¾ç¨‹æ˜¯ä¸€ä¸ªå­˜å‚¨åº“è€Œä¸æ˜¯æœåŠ¡ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨è¿™é‡Œå®é™…ä¸Šæœ‰ä»€ä¹ˆï¼Ÿ</p>

<p>è¯¥ç±»ç”¨æ³¨é‡Š<code class="language-plaintext highlighter-rouge">@Repository</code>æ¥å¯ç”¨ä»JPAå¼‚å¸¸åˆ°Spring <code class="language-plaintext highlighter-rouge">DataAccessException</code>å±‚æ¬¡ç»“æ„çš„å¼‚å¸¸è½¬æ¢ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒ<code class="language-plaintext highlighter-rouge">@Transactional</code>æ¥ç¡®ä¿<code class="language-plaintext highlighter-rouge">save(â€¦)</code>æ“ä½œåœ¨äº‹åŠ¡ä¸­è¿è¡Œå¹¶å…è®¸è®¾ç½®<code class="language-plaintext highlighter-rouge">readOnly-flagï¼ˆåœ¨ç±»çº§åˆ«ï¼‰findByCustomer(â€¦)</code>ã€‚è¿™ä¼šåœ¨æŒä¹…æ€§æä¾›ç¨‹åºå†…éƒ¨ä»¥åŠæ•°æ®åº“çº§åˆ«ä¸Šå¯¼è‡´ä¸€äº›æ€§èƒ½ä¼˜åŒ–ã€‚</p>

<p>å½“æˆ‘ä»¬æƒ³ä»å†³å®šæ˜¯å¦æ‹¨æ‰“å…è´¹å®¢æˆ·ç«¯<code class="language-plaintext highlighter-rouge">merge(â€¦)</code>æˆ–<code class="language-plaintext highlighter-rouge">persist(â€¦)</code>åœ¨EntityManageræˆ‘ä»¬ä½¿ç”¨idçš„-åœº<code class="language-plaintext highlighter-rouge">Account</code>æ¥å†³å®šæˆ‘ä»¬æ˜¯å¦è€ƒè™‘ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Account</code>å¯¹è±¡ä½œä¸ºæ–°çš„æˆ–ä¸ã€‚è¿™ä¸ªé€»è¾‘å½“ç„¶å¯ä»¥è¢«æå–åˆ°ä¸€ä¸ªé€šç”¨çš„è¶…ç±»ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›ä¸ºæ¯ä¸ªåŸŸå¯¹è±¡ç‰¹å®šçš„å­˜å‚¨åº“å®ç°é‡å¤æ­¤ä»£ç ã€‚æŸ¥è¯¢æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢ï¼Œç»‘å®šä¸€ä¸ªå‚æ•°å¹¶æ‰§è¡ŒæŸ¥è¯¢ä»¥è·å¾—ç»“æœã€‚è¿™å‡ ä¹è®©ç›´è¡Œå‘å‰ï¼Œäººä»¬å¯ä»¥æŠŠä»£ç çš„æ‰§è¡Œä½œä¸ºæ ·æ¿ä¸æƒ³è±¡çš„æœ‰ç‚¹æ˜¯æºè‡ªæ–¹æ³•ç­¾åï¼šæˆ‘ä»¬é¢„æœŸListçš„<code class="language-plaintext highlighter-rouge">Accounts</code>ï¼ŒæŸ¥è¯¢éå¸¸æ¥è¿‘æ–¹æ³•åç§°ï¼Œæˆ‘ä»¬åªéœ€å°†æ–¹æ³•å‚æ•°ç»‘å®šåˆ°å®ƒã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿˜æœ‰æ”¹è¿›çš„ç©ºé—´ã€‚</p>

<h4 id="spring-data-repository-support">Spring Data repository support</h4>

<p>åœ¨æˆ‘ä»¬å¼€å§‹é‡æ„å®ç°ä¹‹å‰ï¼Œè¯·æ³¨æ„ï¼Œç¤ºä¾‹é¡¹ç›®åŒ…å«å¯ä»¥åœ¨é‡æ„è¿‡ç¨‹ä¸­è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œä»¥éªŒè¯ä»£ç æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•æ”¹è¿›å®æ–½ã€‚</p>

<p>Spring Data JPAæä¾›äº†ä¸€ä¸ªä»¥æ¯ä¸ªæ‰˜ç®¡åŸŸå¯¹è±¡çš„æ¥å£å¼€å§‹çš„å­˜å‚¨åº“ç¼–ç¨‹æ¨¡å‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span> <span class="err">â€¦</span> <span class="o">}</span>
</code></pre></div></div>

<p>å®šä¹‰è¿™ä¸ªæ¥å£æœ‰ä¸¤ä¸ªç›®çš„ï¼šé¦–å…ˆï¼Œé€šè¿‡æ‰©å±•ï¼Œ<code class="language-plaintext highlighter-rouge">JpaRepository</code>æˆ‘ä»¬å¾—åˆ°äº†ä¸€äº›é€šç”¨çš„CRUDæ–¹æ³•åˆ°æˆ‘ä»¬çš„ç±»å‹ä¸­ï¼Œå…è®¸ä¿å­˜<code class="language-plaintext highlighter-rouge">Account</code>ï¼Œåˆ é™¤å®ƒä»¬ç­‰ç­‰ã€‚å…¶æ¬¡ï¼Œè¿™å°†å…è®¸Spring Data JPAå­˜å‚¨åº“åŸºç¡€ç»“æ„æ‰«æè¯¥æ¥å£çš„ç±»è·¯å¾„å¹¶ä¸ºå…¶åˆ›å»ºä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Spring bean</code>ã€‚</p>

<p>ä¸ºäº†è®©Springåˆ›å»ºä¸€ä¸ªå®ç°æ­¤æ¥å£çš„beanï¼Œæ‚¨åªéœ€ä½¿ç”¨Spring JPAå‘½åç©ºé—´å¹¶ä½¿ç”¨ç›¸åº”çš„å…ƒç´ æ¿€æ´»å­˜å‚¨åº“æ”¯æŒï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nl">jpa:</span><span class="n">repositories</span> <span class="n">base</span><span class="o">-</span><span class="kn">package</span><span class="err">="</span><span class="nn">com.acme.repositories</span><span class="err">"</span> <span class="o">/&gt;</span>
</code></pre></div></div>

<p>è¿™å°†æ‰«æä¸‹é¢æ‰€æœ‰åŒ…çš„<code class="language-plaintext highlighter-rouge">com.acme.repositories</code>æ‰©å±•æ¥å£ï¼ŒJpaRepositoryå¹¶ä¸ºå®ƒåˆ›å»ºä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Spring bean</code>ï¼Œå®ƒç”±ä¸€ä¸ªå®ç°æ”¯æŒ<code class="language-plaintext highlighter-rouge">SimpleJpaRepository</code>ã€‚è®©æˆ‘ä»¬è¿ˆå‡ºç¬¬ä¸€æ­¥ï¼Œé‡æ–°æ„å»º<code class="language-plaintext highlighter-rouge">AccountService</code>ä¸€ä¸‹æˆ‘ä»¬çš„å®ç°æ¥ä½¿ç”¨æˆ‘ä»¬æ–°å¼•å…¥çš„å­˜å‚¨åº“æ¥å£ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="nc">AccountService</span> <span class="o">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">AccountRepository</span> <span class="n">repository</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TypedQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Account a where a.customer = ?1"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">customer</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨é‡æ„ä¹‹åï¼Œæˆ‘ä»¬åªéœ€å°†è°ƒç”¨å§”æ‰˜<code class="language-plaintext highlighter-rouge">save(â€¦)</code>ç»™å­˜å‚¨åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå­˜å‚¨åº“å®ç°çš„<code class="language-plaintext highlighter-rouge">id</code>å±æ€§<code class="language-plaintext highlighter-rouge">null</code>ä¸æ‚¨åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ä¸€æ ·ï¼ˆæ³¨æ„ï¼Œå¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥è·å¾—å¯¹è¯¥å†³å®šçš„æ›´è¯¦ç»†æ§åˆ¶ï¼‰ï¼Œåˆ™å­˜å‚¨åº“å®ç°å°†è€ƒè™‘ä¸€ä¸ªæ–°çš„å®ä½“ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤<code class="language-plaintext highlighter-rouge">@Transactional</code>è¯¥æ–¹æ³•çš„æ³¨é‡Šï¼Œå› ä¸ºSpring Data JPAå­˜å‚¨åº“å®ç°çš„CRUDæ–¹æ³•å·²ç»æ³¨é‡Šäº†<code class="language-plaintext highlighter-rouge">@Transactional</code>ã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†é‡æ„æŸ¥è¯¢æ–¹æ³•ã€‚è®©æˆ‘ä»¬æŒ‰ç…§ä¸saveæ–¹æ³•ç›¸åŒçš„æŸ¥è¯¢æ–¹æ³•çš„å§”æ‰˜ç­–ç•¥ã€‚æˆ‘ä»¬åœ¨å­˜å‚¨åº“æ¥å£ä¸Šå¼•å…¥ä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼Œå¹¶å°†æˆ‘ä»¬åŸæ¥çš„æ–¹æ³•å§”æ‰˜ç»™æ–°å¼•å…¥çš„æ–¹æ³•ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="nc">AccountService</span> <span class="o">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">AccountRepository</span> <span class="n">repository</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è®©æˆ‘åœ¨è¿™é‡Œæ·»åŠ å…³äºäº‹åŠ¡å¤„ç†çš„ç®€è¦è¯´æ˜ã€‚åœ¨è¿™ç§éå¸¸ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨åˆ é™¤ç±»ä¸­çš„<code class="language-plaintext highlighter-rouge">@Transactional</code>æ³¨é‡Šï¼Œ<code class="language-plaintext highlighter-rouge">AccountServiceImpl</code>å› ä¸ºå­˜å‚¨åº“çš„CRUDæ–¹æ³•æ˜¯äº‹åŠ¡æ€§çš„ï¼ŒæŸ¥è¯¢æ–¹æ³•ç”¨<code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code>å·²ç»åœ¨å‚¨å­˜åº“ç•Œé¢ã€‚å½“å‰çš„è®¾ç½®ï¼ˆæœåŠ¡çº§åˆ«çš„æ–¹æ³•æ ‡è®°ä¸ºäº‹åŠ¡æ€§çš„ï¼ˆå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦ï¼‰ï¼‰æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºåœ¨æŸ¥çœ‹äº‹åŠ¡ä¸­æ­£åœ¨å‘ç”Ÿçš„æ“ä½œçš„æœåŠ¡çº§åˆ«æ—¶ï¼Œå®ƒæ˜¯æ˜ç¡®æ¸…æ™°çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœä¿®æ”¹æœåŠ¡å±‚æ–¹æ³•ä»¥å¯¹å­˜å‚¨åº“æ–¹æ³•è¿›è¡Œå¤šæ¬¡è°ƒç”¨ï¼Œåˆ™æ‰€æœ‰ä»£ç ä»å°†åœ¨å•ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå› ä¸ºå­˜å‚¨åº“çš„å†…éƒ¨äº‹åŠ¡åªä¼šåŠ å…¥åœ¨æœåŠ¡å±‚å¯åŠ¨çš„å¤–éƒ¨äº‹åŠ¡ã€‚å­˜å‚¨åº“çš„äº¤æ˜“è¡Œä¸ºå’Œè°ƒæ•´å®ƒçš„å¯èƒ½æ€§åœ¨å‚è€ƒæ–‡æ¡£ä¸­è¯¦ç»†è®°å½•ã€‚</p>

<p>å°è¯•å†æ¬¡è¿è¡Œæµ‹è¯•ç”¨ä¾‹å¹¶æŸ¥çœ‹å®ƒçš„å·¥ä½œåŸç†ã€‚åœæ­¢ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ä»»ä½•<code class="language-plaintext highlighter-rouge">findByCustomer(â€¦)</code>æ­£ç¡®çš„å®æ–½ï¼Ÿè¿™ä¸ªæ€ä¹ˆç”¨ï¼Ÿ</p>

<h4 id="query-methods">Query methods</h4>
<p>å½“Spring Data JPAä¸º<code class="language-plaintext highlighter-rouge">AccountRepository</code>æ¥å£åˆ›å»ºSpring beanå®ä¾‹æ—¶ï¼Œå®ƒå°†æ£€æŸ¥å…¶ä¸­å®šä¹‰çš„æ‰€æœ‰æŸ¥è¯¢æ–¹æ³•å¹¶ä¸ºå®ƒä»¬ä¸­çš„æ¯ä¸ªæŸ¥è¯¢æ´¾ç”ŸæŸ¥è¯¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Data JPAå°†è‡ªåŠ¨åˆ†ææ–¹æ³•åç§°å¹¶ä»ä¸­åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢ã€‚è¯¥æŸ¥è¯¢æ˜¯ä½¿ç”¨JPAæ ‡å‡†APIå®ç°çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥<code class="language-plaintext highlighter-rouge">findByCustomer(â€¦)</code>æ–¹æ³•åœ¨é€»è¾‘ä¸Šç­‰åŒäºJPQLæŸ¥è¯¢<code class="language-plaintext highlighter-rouge">select a from Account a where a.customer = ?1</code>ã€‚è¯¥åˆ†ææ–¹æ³•åè§£æå™¨æ”¯æŒç›¸å½“å¤§é›†å¦‚å…³é”®å­—<code class="language-plaintext highlighter-rouge">And</code>ï¼Œ<code class="language-plaintext highlighter-rouge">Or</code>ï¼Œ<code class="language-plaintext highlighter-rouge">GreaterThan</code>ï¼Œ<code class="language-plaintext highlighter-rouge">LessThan</code>ï¼Œ<code class="language-plaintext highlighter-rouge">Like</code>ï¼Œ<code class="language-plaintext highlighter-rouge">IsNull</code>ï¼Œ<code class="language-plaintext highlighter-rouge">Not</code>ç­‰ã€‚<code class="language-plaintext highlighter-rouge">OrderBy</code>å¦‚æœä½ å–œæ¬¢ï¼Œä½ ä¹Ÿå¯ä»¥æ·»åŠ å­å¥ã€‚æœ‰å…³è¯¦ç»†æ¦‚è¿°ï¼Œè¯·æŸ¥é˜…å‚è€ƒæ–‡æ¡£ã€‚è¿™ç§æœºåˆ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æŸ¥è¯¢æ–¹æ³•ç¼–ç¨‹æ¨¡å‹ï¼Œå°±åƒæ‚¨åœ¨Grailsæˆ–Spring Rooä¸­ä½¿ç”¨çš„é‚£æ ·ã€‚</p>

<p>ç°åœ¨è®©æˆ‘ä»¬å‡è®¾ä½ æƒ³æ˜ç¡®è¦ä½¿ç”¨çš„æŸ¥è¯¢ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥<code class="language-plaintext highlighter-rouge">Account.findByCustomer</code>åœ¨å®ä½“æˆ–æ‚¨çš„æ³¨é‡Šä¸­å£°æ˜éµå¾ªå‘½åçº¦å®šï¼ˆæœ¬ä¾‹ä¸­ä¸ºï¼‰çš„JPAå‘½åæŸ¥è¯¢<code class="language-plaintext highlighter-rouge">orm.xml</code>ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ³¨é‡Šåº“æ–¹æ³•<code class="language-plaintext highlighter-rouge">@Query</code>ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="nd">@Query</span><span class="o">(</span><span class="s">"&lt;JPQ statement here&gt;"</span><span class="o">)</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<p>ç°åœ¨è®©æˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">CustomerServiceImpl</code>åº”ç”¨æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢çœ‹åˆ°çš„åŠŸèƒ½ä¹‹å‰/ä¹‹ååšä¸€ä¸ªæ¯”è¾ƒï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerServiceImpl</span> <span class="kd">implements</span> <span class="nc">CustomerService</span> <span class="o">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Customer</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select c from Customer c"</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="kt">int</span> <span class="n">page</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TypedQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select c from Customer c"</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">query</span><span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="n">page</span> <span class="o">*</span> <span class="n">pageSize</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="n">pageSize</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="nc">Customer</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// Is new?</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">customer</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="kt">int</span> <span class="n">page</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TypedQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select c from Customer c where c.lastname = ?1"</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">lastname</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="n">page</span> <span class="o">*</span> <span class="n">pageSize</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="n">pageSize</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¥½çš„ï¼Œæˆ‘ä»¬å…ˆåˆ›å»º<code class="language-plaintext highlighter-rouge">CustomerRepository</code>å¹¶åˆ é™¤CRUDæ–¹æ³•ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CustomerRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span> <span class="err">â€¦</span> <span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerServiceImpl</span> <span class="kd">implements</span> <span class="nc">CustomerService</span> <span class="o">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">CustomerRepository</span> <span class="n">repository</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Customer</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="kt">int</span> <span class="n">page</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TypedQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select c from Customer c"</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">query</span><span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="n">page</span> <span class="o">*</span> <span class="n">pageSize</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="n">pageSize</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="nc">Customer</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="kt">int</span> <span class="n">page</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TypedQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select c from Customer c where c.lastname = ?1"</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">lastname</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="n">page</span> <span class="o">*</span> <span class="n">pageSize</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="n">pageSize</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æŒºå¥½ã€‚ç°åœ¨å‰©ä¸‹çš„æ˜¯å¤„ç†å¸¸è§åœºæ™¯çš„ä¸¤ç§æ–¹æ³•ï¼šæ‚¨ä¸æƒ³è®¿é—®ç»™å®šæŸ¥è¯¢çš„æ‰€æœ‰å®ä½“ï¼Œè€Œä»…è®¿é—®å…¶ä¸­çš„ä¸€ä¸ªé¡µé¢ï¼ˆä¾‹å¦‚ï¼Œé¡µé¢1çš„é¡µé¢å¤§å°ä¸º10ï¼‰ã€‚ç°åœ¨ï¼Œè¿™æ˜¯ç”¨ä¸¤ä¸ªé€‚å½“é™åˆ¶æŸ¥è¯¢çš„æ•´æ•°æ¥è§£å†³çš„ã€‚è¿™æœ‰ä¸¤ä¸ªé—®é¢˜ã€‚ä¸¤ä¸ªæ•´æ•°å®é™…ä¸Šä»£è¡¨äº†ä¸€ä¸ªæ¦‚å¿µï¼Œè¿™é‡Œæ²¡æœ‰æ˜ç¡®è¯´æ˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªç®€å•çš„<code class="language-plaintext highlighter-rouge">List</code>æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¤±å»äº†å…³äºå®é™…æ•°æ®é¡µé¢çš„å…ƒæ•°æ®ä¿¡æ¯ï¼šå®ƒæ˜¯ç¬¬ä¸€é¡µå—ï¼Ÿè¿™æ˜¯æœ€åä¸€ä¸ªå—ï¼Ÿæ€»å…±æœ‰å‡ é¡µï¼ŸSpring Dataæä¾›äº†ä¸€ä¸ªç”±ä¸¤ä¸ªæ¥å£ç»„æˆçš„æŠ½è±¡<code class="language-plaintext highlighter-rouge">Pageable</code>ï¼ˆæ•è·åˆ†é¡µè¯·æ±‚ä¿¡æ¯ï¼‰ä»¥åŠ<code class="language-plaintext highlighter-rouge">Page</code>ï¼ˆæ•è·ç»“æœä»¥åŠå…ƒä¿¡æ¯ï¼‰ã€‚æ‰€ä»¥è®©æˆ‘ä»¬å°è¯•æ·»åŠ <code class="language-plaintext highlighter-rouge">findByLastname(â€¦)</code>åˆ°ç‰ˆæœ¬åº“æ¥å£å¹¶é‡å†™<code class="language-plaintext highlighter-rouge">findAll(â€¦)</code>ï¼Œ<code class="language-plaintext highlighter-rouge">findByLastname(â€¦)</code>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CustomerRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span> 
<span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findByLastname</span><span class="o">(</span><span class="n">lastname</span><span class="o">,</span> <span class="n">pageable</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<p>ç¡®ä¿ä½ æ ¹æ®ç­¾åçš„å˜åŒ–è°ƒæ•´æµ‹è¯•ç”¨ä¾‹ï¼Œä½†æ˜¯ä»–ä»¬åº”è¯¥è¿è¡Œè‰¯å¥½ã€‚æœ‰ä¸¤ä»¶äº‹æƒ…å¯ä»¥å½’ç»“åˆ°è¿™é‡Œï¼šæˆ‘ä»¬æœ‰æ”¯æŒåˆ†é¡µçš„CRUDæ–¹æ³•ï¼Œå¹¶ä¸”æŸ¥è¯¢æ‰§è¡Œæœºåˆ¶ä¹ŸçŸ¥é“<code class="language-plaintext highlighter-rouge">Pageable</code>å‚æ•°ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬çš„åŒ…è£…ç±»å®é™…ä¸Šå·²ç»è¿‡æ—¶ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¯èƒ½ç›´æ¥ä½¿ç”¨æˆ‘ä»¬çš„å­˜å‚¨åº“æ¥å£ã€‚æˆ‘ä»¬æ‘†è„±äº†æ•´ä¸ªå®æ–½ä»£ç ã€‚</p>

<h4 id="summary">Summary</h4>
<p>åœ¨æœ¬åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨3ç§æ–¹æ³•å’Œä¸€è¡ŒXMLå°†ç”¨äºå­˜å‚¨åº“çš„ä»£ç é‡å‡å°‘åˆ°ä¸¤ä¸ªæ¥å£ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CustomerRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findByCustomer</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">);</span> 
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nl">jpa:</span><span class="n">repositories</span> <span class="n">base</span><span class="o">-</span><span class="kn">package</span><span class="err">="</span><span class="nn">com.acme.repositories</span><span class="err">"</span> <span class="o">/&gt;</span>
</code></pre></div></div>

<p>æˆ‘ä»¬æœ‰ç±»å‹å®‰å…¨çš„CRUDæ–¹æ³•ï¼ŒæŸ¥è¯¢æ‰§è¡Œå’Œå†…ç½®çš„åˆ†é¡µã€‚æœ€é…·çš„æ˜¯ï¼Œè¿™ä¸ä»…é€‚ç”¨äºåŸºäºJPAçš„å­˜å‚¨åº“ï¼Œè€Œä¸”é€‚ç”¨äºéå…³ç³»æ•°æ®åº“ã€‚æ”¯æŒè¿™ç§æ–¹æ³•çš„ç¬¬ä¸€ä¸ªéå…³ç³»æ•°æ®åº“å°†ä½œä¸ºSpring Data Dataå‘å¸ƒçš„ä¸€éƒ¨åˆ†åœ¨å‡ å¤©å†…æˆä¸ºMongoDBã€‚æ‚¨å°†è·å¾—ä¸Mongo DBå®Œå…¨ç›¸åŒçš„åŠŸèƒ½ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿåœ¨ä¸ºå…¶ä»–æ•°æ®åº“æä¾›æ”¯æŒã€‚è¿˜æœ‰ä¸€äº›é¢å¤–çš„åŠŸèƒ½éœ€è¦æ¢è®¨ï¼ˆä¾‹å¦‚ï¼Œå®ä½“å®¡æ ¸ï¼Œè‡ªå®šä¹‰æ•°æ®è®¿é—®ä»£ç çš„é›†æˆï¼‰ï¼Œ<a href="https://github.com/spring-projects/spring-data-examples/tree/master/jpa/showcase">GitHub</a>æœ‰ä¸ªDemoã€‚</p>

<blockquote>
  <p><strong>è½¬è½½ï¼š å¥¥åˆ©å¼—å‰å°”å…‹:<a href="http://spring.io/blog/2011/02/10/getting-started-with-spring-data-jpa/">http://spring.io/blog/2011/02/10/getting-started-with-spring-data-jpa/</a></strong></p>
</blockquote>

<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fqj5aochgoj309k09kmwz.jpg" alt="" />
<b><center>æ‰«æå…³æ³¨ï¼šçƒ­çˆ±ç”Ÿæ´»çš„å¤§å”</center>
<b><center><font size="2">ï¼ˆ<font size="2" color="#FF0000">è½¬è½½æœ¬ç«™æ–‡ç« è¯·æ³¨æ˜ä½œè€…å’Œå‡ºå¤„</font> <font size="2" color="#0000FF">çƒ­çˆ±ç”Ÿæ´»çš„å¤§å”-uniquezhangqi</font><font size="2">ï¼‰</font></font></center></b></b></p>
:ET